USE master;
EXEC sp_configure 'clr enabled', 1;
RECONFIGURE;
go

ALTER DATABASE  testdb
SET TRUSTWORTHY ON
go

USE testdb;

GO
PRINT N'Creating Assembly [CLRMemTest]...';


GO
CREATE ASSEMBLY [CLRMemTest]
    AUTHORIZATION [dbo]
    FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300CE7E30660000000000000000E00022200B013000001200000006000000000000C63100000020000000400000000000100020000000020000040000000000000006000000000000000080000000020000D2150100030060850000100000100000000010000010000000000000100000000000000000000000743100004F00000000400000B002000000000000000000000000000000000000006000000C0000003C3000001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000CC110000002000000012000000020000000000000000000000000000200000602E72737263000000B0020000004000000004000000140000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001800000000000000000000000000004000004200000000000000000000000000000000A8310000000000004800000002000500802500003C0A000009000000000000000000000000000000BC2F0000800000000000000000000000000000000000000000000000000000000000000000000000133002001F000000010000117201000070020A1200FE16090000016F0500000A280600000A280700000A2A00133003004900000002000011730800000A0A0F00280900000A8D0F0000010B160C2B0E0708066F0A00000AD29C0817580C08078E6932EC7217000070076F0B00000A0D1203280C00000A280600000A280700000A2A42280D00000A7231000070280700000A2A00001330020031000000030000110216280E00000A280F00000A281000000A16FE01281100000A0A72410000701200281200000A280600000A280700000A2A0000001B3002005500000004000011160A160B2B25726B000070731300000A0C086F1400000A0607580ADE0A082C06086F1500000ADC0717580B07280E00000A02281600000A281000000A2DC8729B0000701200280C00000A280600000A280700000A2A00000001100000020011000C1D000A000000001B3003009600000005000011160A160B2B66726B000070731300000A0C086F1400000A086F1700000A72BF0000700D25086F1800000A25096F1900000A6F1A00000A130411046F1B00000A2C0F1104166F1C00000A1305061105580ADE1611042C0711046F1500000ADC082C06086F1500000ADC0717580B07280E00000A02281600000A281000000A2D8772010000701200280C00000A280600000A280700000A2A0000011C0000020038001A52000C00000000020011004D5E000A000000001B300200DD00000006000011160A160B38A7000000726B000070731300000A0C086F1400000A086F1700000A0D09086F1800000A72BF00007013040911046F1900000A096F1A00000A130611066F1B00000A2C0F1106166F1C00000A1307061107580ADE0C11062C0711066F1500000ADC72DD00007013050911056F1900000A096F1A00000A130811086F1B00000A2C0F1108166F1C00000A1309061109580ADE1611082C0711086F1500000ADC082C06086F1500000ADC0717580B07280E00000A02281600000A281000000A3A43FFFFFF72010000701200280C00000A280600000A280700000A2A0000000128000002003F001A59000C0000000002007C001A96000C00000000020014008EA2000A000000001B3002009900000007000011160A72BF0000700B160C2B63726B000070731300000A0D096F1400000A0709731D00000A130411046F1A00000A130511056F1B00000A2C0F1105166F1C00000A1306061106580ADE2211052C0711056F1500000ADC11042C0711046F1500000ADC092C06096F1500000ADC0817580C08280E00000A02281600000A281000000A2D8A72010000701200280C00000A280600000A280700000A2A0000000128000002002F001A49000C00000000020026002F55000C00000000020017004A61000A000000001B300200EF00000008000011160A72BF0000700B72DD0000700C160D38AD000000726B000070731300000A130411046F1400000A071104731D00000A130511056F1A00000A130611066F1B00000A2C0F1106166F1C00000A1307061107580ADE1811062C0711066F1500000ADC11052C0711056F1500000ADC081104731D00000A130811086F1A00000A130911096F1B00000A2C0F1109166F1C00000A130A06110A580ADE2411092C0711096F1500000ADC11082C0711086F1500000ADC11042C0711046F1500000ADC0917580D09280E00000A02281600000A281000000A3A3DFFFFFF72010000701200280C00000A280600000A280700000A2A000140000002003B001A55000C00000000020032002F61000C00000000020080001A9A000C00000000020077002FA6000C000000000200210091B2000C000000001E02281E00000A2A42534A4201000100000000000C00000076342E302E33303331390000000005006C00000000030000237E00006C0300009403000023537472696E67730000000000070000FC00000023555300FC0700001000000023475549440000000C0800003002000023426C6F620000000000000002000001471502000900000000FA0133001600000100000017000000020000000A000000090000001E0000000C0000000800000001000000020000000000C7010100000000000600D100AD020600F100AD020600A8009A020F00CD02000006000D03D6010A00BC0079020A00790079020A002601DC020A000100DC020600DD01D6010A001C0228030A005D0228030A006E00280306003201D60106000F01D60106000D00D60106002A00D6010A00E401DC0206001300D6010A000F023D0206009400D6010A0056003D020A0050023D02000000001900000000000100010001001000F102000015000100010050200000000096008703670101007C20000000009600420067010200D120000000009600220067010300E42000000000960068036701040024210000000096002A026701050098210000000096007E01670106005822000000009600A001670107006C230000000096003901670108003C240000000096005901670109007825000000008618940206000A00000001003E03000001003E03000001003E03000001003E03000001003E03000001003E03000001003E03000001003E03000001003E03090094020100110094020600190094020A0031009402060029003001150071000603190041001C031F00510094020600490014012E00510053032E00290088002E0081003001150089001403320049001C033A0049007B03400091001E01490089006C034F00990030011500590094025B00A100FB010600A900A00006004900EF014000590060006B00690000027000B10058035B0069006B027600B90051007B00B9000A007F0069009402A200290094020600200023009F012E000B006E012E00130077012E001B009601400023009F01600023009F01800023009F01A00023009F01C00023009F01E00023009F01000123009F01200123009F011000250036005400600084009500A90004800000000000000000000001000000C50048030000040000000000000000000000BC00390000000000040000000000000000000000BC002D0000000000000000000053716C496E74333200476574496E74333200496E743634003C4D6F64756C653E005465737443616C6C47430053797374656D2E44617461006D73636F726C69620054657374456D707479416C6C6F630052656164004462436F6D6D616E6400437265617465436F6D6D616E640053716C436F6D6D616E6400446174614163636573734B696E640047657448617368436F64650049446973706F7361626C6500446973706F73650044656275676761626C654174747269627574650053716C46756E6374696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650042797465006765745F56616C7565006F705F547275650053716C537472696E6700546F537472696E6700546573744C6F6F70436F6E6E656374696F6E5F436F6D6D616E645573696E6700546573744C6F6F70436F6E6E656374696F6E5F436F6D6D616E644D756C74695573696E6700546573744C6F6F70436F6E6E656374696F6E5F436F6D6D616E644E6F5573696E6700546573744C6F6F70436F6E6E656374696F6E5F436F6D6D616E644D756C74694E6F5573696E6700434C524D656D546573742E646C6C0053797374656D0052616E646F6D0053716C426F6F6C65616E006F705F4C6573735468616E004F70656E007365745F436F6E6E656374696F6E004462436F6E6E656374696F6E0053716C436F6E6E656374696F6E00546573744C6F6F70436F6E6E656374696F6E0053797374656D2E446174612E436F6D6D6F6E004462446174615265616465720053716C446174615265616465720045786563757465526561646572004D6963726F736F66742E53716C5365727665722E536572766572002E63746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F6465730053797374656D2E446174612E53716C54797065730055736572446566696E656446756E6374696F6E7300436F6E636174004F626A65637400436F6C6C656374006F705F496D706C696369740053797374656D2E446174612E53716C436C69656E74006C6F6F70436F756E7400434C524D656D54657374004E657874007365745F436F6D6D616E64546578740054657374476574546F74616C4D656D6F7279006F705F457175616C6974790054657374456D7074790000000000154F004B0020003A0020004C006F006F0070003D0000194F004B0020003A002000520061006E0064006F006D003D00000F4F004B0020003A0020004700430000294F004B0020003A00200047006500740054006F00740061006C004D0065006D006F00720079003D00002F63006F006E007400650078007400200063006F006E006E0065006300740069006F006E003D00740072007500650000234F004B0020003A00200043006F006E006E0065006300740069006F006E0073003D00001D730065006C0065006300740020003100200061007300200076003B00001D730065006C0065006300740020003200200061007300200076003B0000006DA99C9DA755C646A1C9B7CE702FCCFE0004200101080320000105200101111104070111250320000E0500020E0E0E05000111210E08070412291D05080803200008030000010307010A0500011125080800021149112511250500010211490400010A020607030808122D042001010E0A07060808122D0E123108042000123505200101122D042000123103200002042001080810070A0808122D12350E0E1231081231080C0707080E08122D1235123108062002010E122D12070B080E0E08122D1235123108123512310808B77A5C561934E08980A0002400000480000094000000060200000024000052534131000400000100010061617075D49053F59CDEDF1A819F78597DD56EC1A91137CE8E85A689B72B8AFC555C102D10BEB04A0E9A37723075E0F5687B9DA8F794420F8BE3801F247072384D70859A5AFB03D8DD0BFB56588EBB943E80F2850E03F93B558C039794604D3A9BAAAD921F99D139A0230C974D20FFF364D533755CED9002CF94744F67398DC7060001112111250801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F777301080100020000000000808F010001005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D342E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A44617461416363657373010000002A0011CB6691C430E4036208368727961466F9456E897E2BC3DFB57DBD3044511065F452A56E7C89B4FE978B00D376040F95A06F5FC76A3FE4D64BFBEF0D4B66B37DA8F74289760BDB5A5B0C01904C3A2D82C27DECB672C8677F6472CCC7FE9B667C7B3CDF30F98B6375C2CC839E366CDFC3B62F4BB05B9C7047715CD2572FA400000000CE7E306600000000020000001C010000583000005812000052534453C4BFF90D36CB3642A25C97CA73DF3689010000005A3A5C70726F6A656374735C434C524D656D546573745C6F626A5C52656C656173655C434C524D656D546573742E706462000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009C3100000000000000000000B6310000002000000000000000000000000000000000000000000000A8310000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF25002000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000540200000000000000000000540234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000000000000000000000000000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004B4010000010053007400720069006E006700460069006C00650049006E0066006F0000009001000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000030002E0030002E0030002E00300000003E000F00010049006E007400650072006E0061006C004E0061006D006500000043004C0052004D0065006D0054006500730074002E0064006C006C00000000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000046000F0001004F0072006900670069006E0061006C00460069006C0065006E0061006D006500000043004C0052004D0065006D0054006500730074002E0064006C006C0000000000340008000100500072006F006400750063007400560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000030002E0030002E0030002E003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000C000000C83100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;


GO
PRINT N'Creating Function [dbo].[TestEmpty]...';


GO
CREATE FUNCTION [dbo].[TestEmpty]
(@loopCount INT NULL)
RETURNS NVARCHAR (MAX)
AS
 EXTERNAL NAME [CLRMemTest].[UserDefinedFunctions].[TestEmpty]


GO
PRINT N'Creating Function [dbo].[TestEmptyAlloc]...';


GO
CREATE FUNCTION [dbo].[TestEmptyAlloc]
(@loopCount INT NULL)
RETURNS NVARCHAR (MAX)
AS
 EXTERNAL NAME [CLRMemTest].[UserDefinedFunctions].[TestEmptyAlloc]


GO
PRINT N'Creating Function [dbo].[TestCallGC]...';


GO
CREATE FUNCTION [dbo].[TestCallGC]
(@loopCount INT NULL)
RETURNS NVARCHAR (MAX)
AS
 EXTERNAL NAME [CLRMemTest].[UserDefinedFunctions].[TestCallGC]

GO
PRINT N'Creating Function [dbo].[TestGetTotalMemory]...';


GO
CREATE FUNCTION [dbo].[TestGetTotalMemory]
(@loopCount INT NULL)
RETURNS NVARCHAR (MAX)
AS
 EXTERNAL NAME [CLRMemTest].[UserDefinedFunctions].[TestGetTotalMemory]


GO
PRINT N'Creating Function [dbo].[TestLoopConnection]...';


GO
CREATE FUNCTION [dbo].[TestLoopConnection]
(@loopCount INT NULL)
RETURNS NVARCHAR (MAX)
AS
 EXTERNAL NAME [CLRMemTest].[UserDefinedFunctions].[TestLoopConnection]


GO
PRINT N'Creating Function [dbo].[TestLoopConnection_CommandNoUsing]...';


GO
CREATE FUNCTION [dbo].[TestLoopConnection_CommandNoUsing]
(@loopCount INT NULL)
RETURNS NVARCHAR (MAX)
AS
 EXTERNAL NAME [CLRMemTest].[UserDefinedFunctions].[TestLoopConnection_CommandNoUsing]


GO
PRINT N'Creating Function [dbo].[TestLoopConnection_CommandMultiNoUsing]...';


GO
CREATE FUNCTION [dbo].[TestLoopConnection_CommandMultiNoUsing]
(@loopCount INT NULL)
RETURNS NVARCHAR (MAX)
AS
 EXTERNAL NAME [CLRMemTest].[UserDefinedFunctions].[TestLoopConnection_CommandMultiNoUsing]


GO
PRINT N'Creating Function [dbo].[TestLoopConnection_CommandUsing]...';


GO
CREATE FUNCTION [dbo].[TestLoopConnection_CommandUsing]
(@loopCount INT NULL)
RETURNS NVARCHAR (MAX)
AS
 EXTERNAL NAME [CLRMemTest].[UserDefinedFunctions].[TestLoopConnection_CommandUsing]


GO
PRINT N'Creating Function [dbo].[TestLoopConnection_CommandMultiUsing]...';


GO
CREATE FUNCTION [dbo].[TestLoopConnection_CommandMultiUsing]
(@loopCount INT NULL)
RETURNS NVARCHAR (MAX)
AS
 EXTERNAL NAME [CLRMemTest].[UserDefinedFunctions].[TestLoopConnection_CommandMultiUsing]

